/* ===== Базовые стили и CSS Переменные ===== */
:root {
    /* --- Светлая тема (по умолчанию) --- */
    --bg-primary: #f0f0f0;
    --bg-secondary: #ffffff;
    --bg-tertiary: #e9e9e9; /* Фон таймера */
    --bg-numpad-button: #ffffff;
    --bg-numpad-button-hover: #eee;
    --bg-numpad-button-active: #ddd;
    --bg-modal: var(--bg-secondary);
    --bg-modal-overlay: rgba(0, 0, 0, 0.6);
    --bg-modal-button: #f8f9fa;
    --bg-modal-button-hover: #e9ecef;
    --bg-modal-button-diff: #e7f3ff;
    --bg-modal-button-diff-hover: #cfe4fa;
    --bg-modal-button-cancel: #f1f1f1;
    --bg-modal-button-cancel-hover: #e1e1e1;

    --text-primary: #333;
    --text-secondary: #555;
    --text-accent: #026bff; /* Введенные пользователем цифры */
    --text-given: #333;    /* Предустановленные цифры */
    --text-note: #555;
    --text-inverted: #ffffff;
    --text-danger: red;
    --text-success: green;
    --text-warning-fg: #212529; /* Текст на желтых кнопках */

    --border-primary: #ccc;
    --border-secondary: black; /* Граница доски, толстые линии */
    --border-modal-button: #ccc;
    --border-modal-button-diff: #b8d6f3;

    --highlight-weak: #e8f4ff; /* Подсветка строки/колонки */
    --highlight-strong: #a7d8ff; /* Выбранная ячейка */
    --highlight-error-bg: #ffdddd; /* Фон ошибочной ячейки */
    --highlight-error-text: var(--text-danger);
    --highlight-hint-flash: #fffacd; /* Вспышка подсказки */

    --button-primary-bg: #007bff;
    --button-primary-hover: #0056b3;
    --button-primary-active: #004085;
    --button-success-bg: #28a745;
    --button-success-hover: #218838;
    --button-success-active: #1e7e34;
    --button-warning-bg: #ffc107;
    --button-warning-hover: #e0a800;
    --button-warning-active: #c69500;
    --button-disabled-bg: #6c757d;
    --button-disabled-opacity: 0.65;
    --button-note-active-bg: var(--button-success-bg);
    --button-note-active-border: var(--button-success-active);
    --button-note-active-shadow: rgba(0, 0, 0, 0.3);

    --shadow-modal: rgba(0, 0, 0, 0.25);
    --shadow-theme-toggle: rgba(0, 0, 0, 0.2);

    --backdrop-filter: blur(3px);
}

body.dark-theme {
    /* --- Темная тема --- */
    --bg-primary: #1e1e1e;
    --bg-secondary: #2c2c2c;
    --bg-tertiary: #3f3f3f;
    --bg-numpad-button: #3f3f3f;
    --bg-numpad-button-hover: #505050;
    --bg-numpad-button-active: #616161;
    --bg-modal: var(--bg-secondary);
    --bg-modal-overlay: rgba(0, 0, 0, 0.75);
    --bg-modal-button: #505050;
    --bg-modal-button-hover: #616161;
    --bg-modal-button-diff: #334f6e;
    --bg-modal-button-diff-hover: #446a94;
    --bg-modal-button-cancel: #444;
    --bg-modal-button-cancel-hover: #555;

    --text-primary: #e0e0e0;
    --text-secondary: #b0b0b0;
    --text-accent: #58a6ff; /* Светло-голубой */
    --text-given: #b0b0b0; /* Менее яркие */
    --text-note: #999;
    --text-inverted: #121212;
    --text-danger: #ff9999; /* Светло-красный */
    --text-success: #99ff99; /* Светло-зеленый */
    --text-warning-fg: #212529; /* Оставляем темный для читаемости на желтом */

    --border-primary: #555;
    --border-secondary: #bbb; /* Светлая граница доски */
    --border-modal-button: #777;
    --border-modal-button-diff: #58a6ff;

    --highlight-weak: #334f6e; /* Темно-синий */
    --highlight-strong: #0058a3; /* Еще темнее синий */
    --highlight-error-bg: #6e3333; /* Темно-красный фон */
    --highlight-error-text: var(--text-danger);
    --highlight-hint-flash: #6a6836; /* Темно-желтый */

    --button-primary-bg: #2386fd;
    --button-primary-hover: #58a6ff;
    --button-primary-active: #1e72d3;
    --button-success-bg: #34ae5a;
    --button-success-hover: #4ddb7a;
    --button-success-active: #2b914c;
    --button-warning-bg: #ffc107; /* Желтый обычно ок */
    --button-warning-hover: #e0a800;
    --button-warning-active: #c69500;
    --button-disabled-bg: #5a5a5a;
    --button-disabled-opacity: 0.7;
    --button-note-active-bg: var(--button-success-bg);
    --button-note-active-border: var(--button-success-active);
    --button-note-active-shadow: rgba(0, 0, 0, 0.5);

    --shadow-modal: rgba(200, 200, 200, 0.2);
    --shadow-theme-toggle: rgba(200, 200, 200, 0.15);

    --backdrop-filter: blur(5px);
}

html {
    height: 100%;
    font-size: 16px;
}

body {
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 5px 10px;
    background-color: var(--bg-primary);
    color: var(--text-primary); /* Цвет текста по умолчанию */
    touch-action: manipulation;
    min-height: 100vh;
    box-sizing: border-box;
    transition: background-color 0.3s ease, color 0.3s ease; /* Плавный переход темы */
}

h1 {
    margin-top: 5px;
    margin-bottom: 8px;
    color: var(--text-primary); /* Используем переменную */
    font-size: 1.6em;
    flex-shrink: 0;
}

/* ===== Стили таймера ===== */
#timer-container {
    margin-bottom: 8px;
    width: clamp(270px, 90vw, 500px);
    max-width: 100%;
    text-align: right;
    flex-shrink: 0;
}
#timer {
    font-size: 1em;
    font-weight: bold;
    color: var(--text-secondary); /* Используем переменную */
    padding: 5px 10px;
    background-color: var(--bg-tertiary); /* Используем переменную */
    border-radius: 4px;
    display: inline-block;
}

/* ===== Стили доски Судоку ===== */
#sudoku-board {
    display: grid;
    grid-template-columns: repeat(9, minmax(28px, 1fr));
    grid-template-rows: repeat(9, minmax(28px, 1fr));
    width: clamp(260px, 85vmin, 480px);
    height: clamp(260px, 85vmin, 480px);
    max-width: 95vw;
    max-height: 65vh;
    border: 3px solid var(--border-secondary); /* Используем переменную */
    margin-bottom: 10px;
    background-color: var(--bg-secondary); /* Используем переменную */
    overflow: hidden;
    transition: filter 0.3s ease-in-out, background-color 0.3s ease, border-color 0.3s ease; /* Добавили переходы */
    flex-shrink: 0;
}

/* --- Стили ячеек и их границ --- */
.cell {
    display: flex;
    justify-content: center;
    align-items: center;
    border: 1px solid var(--border-primary); /* Используем переменную */
    cursor: pointer;
    box-sizing: border-box;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    position: relative;
    overflow: hidden;
    transition: background-color 0.1s ease-in-out, border-color 0.3s ease; /* Добавили переход */
}
/* Убираем двойные границы */
.cell:nth-child(n+10) { border-top: none; }
.cell:not(:nth-child(9n+1)) { border-left: none; }
/* Толстые границы (цвет берется из border-secondary через !important) */
.thick-border-right { border-right-width: 2px !important; border-right-color: var(--border-secondary) !important; }
.thick-border-bottom { border-bottom-width: 2px !important; border-bottom-color: var(--border-secondary) !important; }

/* --- Контейнеры внутри ячейки --- */
.cell-value-container {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; justify-content: center; align-items: center;
    font-size: clamp(1em, 4vmin, 1.5em);
    line-height: 1;
    font-weight: bold;
    color: var(--text-accent); /* Используем переменную */
}
.cell-notes-container {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);
    gap: 0px; padding: 1px; box-sizing: border-box; display: none;
}
.note-digit {
    display: flex; justify-content: center; align-items: center;
    font-size: clamp(0.6em, 2vmin, 0.8em);
    line-height: 1;
    color: var(--text-note); /* Используем переменную */
    text-align: center;
}

/* --- Стили для состояний ячеек --- */
.cell.given {
    background-color: var(--bg-secondary); /* Фон как у доски */
    cursor: default;
}
.cell.given .cell-value-container {
    color: var(--text-given); /* Используем переменную для предустановленных */
}
.cell.highlighted {
    background-color: var(--highlight-weak); /* Используем переменную */
}
.cell.incorrect .cell-value-container {
    color: var(--highlight-error-text) !important; /* Используем переменную */
}
.cell.incorrect {
    background-color: var(--highlight-error-bg); /* Используем переменную */
}
.cell.selected {
    background-color: var(--highlight-strong); /* Используем переменную */
}
/* Стиль для вспышки подсказки (обрабатываем инлайн стиль из JS) */
.cell[style*="background-color: rgb(255, 250, 205)"] {
    background-color: var(--highlight-hint-flash) !important;
}
.cell[style*="background-color: var(--highlight-hint-flash)"] { /* Если JS обновится */
    background-color: var(--highlight-hint-flash) !important;
}


/* ===== Стили элементов управления ===== */
#controls {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
    flex-wrap: wrap;
    justify-content: center;
    flex-shrink: 0;
}
#controls button {
    padding: 8px 12px;
    font-size: 0.9em;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background-color: var(--button-primary-bg); /* Используем переменную */
    color: var(--text-inverted); /* Используем переменную */
    transition: background-color 0.2s, opacity 0.2s;
    white-space: nowrap;
}
#controls button:hover { background-color: var(--button-primary-hover); }
#controls button:active { background-color: var(--button-primary-active); }

/* --- Стили конкретных кнопок управления --- */
#hint-button { background-color: var(--button-success-bg); }
#hint-button:hover { background-color: var(--button-success-hover); }
#hint-button:active { background-color: var(--button-success-active); }
#hint-button:disabled,
#undo-button:disabled {
    background-color: var(--button-disabled-bg);
    opacity: var(--button-disabled-opacity);
    cursor: not-allowed;
}
#undo-button {
    background-color: var(--button-warning-bg);
    color: var(--text-warning-fg); /* Используем переменную */
}
#undo-button:hover { background-color: var(--button-warning-hover); }
#undo-button:active { background-color: var(--button-warning-active); }

/* ===== Стили для сообщения о статусе ===== */
#status-message {
    margin-top: 4px;
    margin-bottom: 8px;
    font-size: 0.9em;
    min-height: 1.2em;
    font-weight: bold; text-align: center;
    flex-shrink: 0;
    transition: color 0.3s ease; /* Плавный переход цвета */
}
.correct { color: var(--text-success); }
.incorrect-msg { color: var(--text-danger); }

/* ===== Стили для цифровой панели ===== */
#numpad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(4, auto);
    gap: 4px;
    margin-top: 0;
    width: clamp(220px, 80vw, 280px);
    max-width: 95vw;
    flex-shrink: 0;
}
#numpad button {
    padding: 8px 0;
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    border: 1px solid var(--border-primary); /* Используем переменную */
    border-radius: 5px;
    background-color: var(--bg-numpad-button); /* Используем переменную */
    color: var(--text-primary); /* Цвет цифр на кнопках */
    transition: background-color 0.2s, box-shadow 0.2s, color 0.2s, border-color 0.2s;
    -webkit-tap-highlight-color: transparent;
}
#numpad button:hover { background-color: var(--bg-numpad-button-hover); }
#numpad button:active { background-color: var(--bg-numpad-button-active); }

#note-toggle-button { grid-column: 1 / 2; grid-row: 4 / 5; font-size: 1.3em; }
#erase-button {
    grid-column: 2 / 4; grid-row: 4 / 5;
    background-color: var(--button-warning-bg);
    color: var(--text-warning-fg);
}
#erase-button:hover { background-color: var(--button-warning-hover); }

/* Стили для активной кнопки заметок */
#note-toggle-button.active {
    background-color: var(--button-note-active-bg);
    color: var(--text-inverted);
    border-color: var(--button-note-active-border);
    box-shadow: inset 0 2px 4px var(--button-note-active-shadow);
}
#note-toggle-button.active:hover { /* Стиль :hover для активной кнопки */
    background-color: var(--button-note-active-bg); /* Не меняем цвет фона */
    color: var(--text-inverted);
    border-color: var(--button-note-active-border);
    box-shadow: inset 0 2px 4px var(--button-note-active-shadow); /* Тень та же */
}

/* ===== Стили для модального окна сложности ===== */
#modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: var(--bg-modal-overlay);
    backdrop-filter: var(--backdrop-filter);
    -webkit-backdrop-filter: var(--backdrop-filter);
    z-index: 100; display: none; opacity: 0;
    transition: opacity 0.3s ease-in-out, background-color 0.3s ease;
    cursor: pointer;
}
#modal-overlay.visible { display: block; opacity: 1; }

#difficulty-modal {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0.95);
    background-color: var(--bg-modal); /* Используем переменную */
    color: var(--text-primary); /* Цвет текста внутри модалки */
    padding: 25px 35px; border-radius: 8px;
    box-shadow: 0 5px 20px var(--shadow-modal); /* Используем переменную */
    z-index: 101; display: none; text-align: center; opacity: 0;
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
}
#difficulty-modal.visible { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
#difficulty-modal h2 { margin-top: 0; margin-bottom: 20px; color: var(--text-primary); } /* Используем переменную */
#difficulty-modal .modal-buttons { display: flex; flex-direction: column; gap: 10px; }
#difficulty-modal .modal-buttons button {
    padding: 12px 20px; font-size: 16px; cursor: pointer;
    border: 1px solid var(--border-modal-button); /* Используем переменную */
    border-radius: 5px;
    background-color: var(--bg-modal-button); /* Используем переменную */
    color: var(--text-primary); /* Используем переменную */
    transition: background-color 0.2s, border-color 0.2s, color 0.2s;
}
#difficulty-modal .modal-buttons button:hover {
    background-color: var(--bg-modal-button-hover); /* Используем переменную */
    border-color: var(--border-primary); /* Можно использовать общую переменную */
}
#difficulty-modal .modal-buttons button.difficulty-button {
    background-color: var(--bg-modal-button-diff); /* Используем переменную */
    border-color: var(--border-modal-button-diff); /* Используем переменную */
}
#difficulty-modal .modal-buttons button.difficulty-button:hover {
    background-color: var(--bg-modal-button-diff-hover); /* Используем переменную */
    border-color: var(--border-accent); /* Можно использовать общую переменную */
}
#difficulty-modal .modal-buttons #cancel-difficulty-button {
    margin-top: 10px;
    background-color: var(--bg-modal-button-cancel); /* Используем переменную */
}
#difficulty-modal .modal-buttons #cancel-difficulty-button:hover {
    background-color: var(--bg-modal-button-cancel-hover); /* Используем переменную */
}

/* ===== Стили для кнопки переключения темы ===== */
#theme-toggle-button {
    position: fixed;
    bottom: 15px;
    right: 15px;
    width: 45px; /* Немного увеличил */
    height: 45px; /* Немного увеличил */
    border-radius: 50%;
    border: 1px solid var(--border-primary);
    background-color: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 1.4em; /* Увеличил иконку */
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 99; /* Ниже оверлея модалки */
    transition: background-color 0.2s, color 0.2s, border-color 0.2s, transform 0.1s ease-out, box-shadow 0.2s ease;
    box-shadow: 0 2px 5px var(--shadow-theme-toggle);
    padding: 0;
    line-height: 1; /* Убираем лишнее пространство для иконки */
}
#theme-toggle-button:hover {
    background-color: var(--bg-tertiary);
}
#theme-toggle-button:active {
    transform: scale(0.92); /* Уменьшил scale при нажатии */
}
